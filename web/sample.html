<!DOCTYPE html>
<html>
  <head>
    <title>Dashboard</title>
    <meta charset="UTF-8" />
    <link
      rel="stylesheet"
      type="text/css"
      href="bower_components/bootstrap/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="bower_components/snackbarjs/dist/snackbar.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="bower_components/titatoggle/dist/titatoggle-dist-min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="bower_components/bootstrap-material-design/dist/css/roboto.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="bower_components/bootstrap-material-design/dist/css/ripples.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="bower_components/bootstrap-material-design/dist/css/material-fullpalette.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="bower_components/nouislider/distribute/nouislider.min.css"
    />
  </head>
  <body style="background-color:black">
    <div class="container" style="padding-top: 30px;">
      <div class="text-center" style="color:white">
        <h1>Publish Service</h1>
        <hr />
        <div style="padding: 0 10% 0 10%;">
          <div id="slider-handles"></div>
        </div>
        <h3>Value: <span id="value">0</span></h3>
        <button
          class="btn btn-material-cyan-500"
          id="publish-button"
          data-value="0"
          style="border-radius: 100px; border: 2px solid #528aae"
        >
          Publish
          <div class="ripple-wrapper"></div>
        </button>
      </div>
	  <br>
	  <br>
      <table class="table table-bordered" style="color: white; width: 60%; margin-left: 20%;">
        <thead>
          <tr>
            <td style="width: 5%; font-size: 20px; text-align: center;"><b>Sensor</b></td>
            <td style="width: 5%; font-size: 20px; text-align: center;"><b>Value</b></td>
          </tr>
        </thead>
        <tr>
          <td style="text-align: center;">Ultrasonic</td>
          <td id="d" style="text-align: center;"></td>
        </tr>
        <tr>
          <td style="text-align: center;">TMP36</td>
          <td id="t3" style="text-align: center;"></td>
        </tr>
        <tr>
          <td style="text-align: center;">DS1621</td>
          <td id="t8" style="text-align: center;"></td>
        </tr>
        <tr>
          <td style="text-align: center;">PIR Sensor</td>
          <td id="pir" style="text-align: center;"></td>
        </tr>
      </table>
    </div>
    <br>
    <div class="text-center" style="color:white">
      <div class="row" style="width: 90%; padding: 0; margin-left: 5.5%;">
          <div class="col-md-12" style="width: 90%; padding: 0; margin-left: 5.5%;">
            <button
              class="btn btn-material-green-A400"
              id="publish-button"
              data-value="on"
              style="border: 2px solid #013220; border-radius: 100px;"
            >
              Light On
              <div class="ripple-wrapper"></div>
            </button>
            <button
              class="btn btn-material-deep-orange-A400"
              id="publish-button"
              data-value="off"
              style="border: 2px solid #8b0000; border-radius: 2px; border-radius: 100px;"
            >
              Light Off
              <div class="ripple-wrapper"></div>
            </button>
          </div>
        </div>
    </div>










    <script
      type="text/javascript"
      src="bower_components/jquery/dist/jquery.min.js"
    ></script>
    <script src="mqttws31.js" type="text/javascript"></script>
    <script
      type="text/javascript"
      src="bower_components/bootstrap/dist/js/bootstrap.min.js"
    ></script>
    <script
      type="text/javascript"
      src="bower_components/nouislider/distribute/nouislider.min.js"
    ></script>
    <script
      type="text/javascript"
      src="bower_components/snackbarjs/dist/snackbar.min.js"
    ></script>
    <script
      type="text/javascript"
      src="bower_components/bootstrap-material-design/dist/js/material.min.js"
    ></script>
    <script
      type="text/javascript"
      src="bower_components/bootstrap-material-design/dist/js/ripples.min.js"
    ></script>
    <script type="text/javascript">
      $(function() {
        $.material.init();

        // URL broker
        var MQTTbroker = "10.30.4.118";
        var MQTTport = 9001;
        // Publish to topic
        var MQTTpublishTopic = "max";

        // Subscribe Topic
        var MQTTsubTopic = "max2";

        //mqtt broker
        var client = new Paho.MQTT.Client(
          MQTTbroker,
          MQTTport,
          "myclientid_012" + parseInt(Math.random() * 100, 10)
        );

        //mqtt connecton options including the mqtt broker subscriptions
        var options = {
          timeout: 3,
          onSuccess: function() {
            console.log("mqtt connected");
            client.subscribe(MQTTsubTopic);
          },
          onFailure: function(message) {
            console.log("Connection failed, ERROR: " + message.errorMessage);
          }
        };

        client.onMessageArrived = onMessageArrived;

        client.connect(options);

        var rangeSlider = document.getElementById("slider-handles");
        var valueShow = document.getElementById("value");
        var snackbarMessage = "Published";

        noUiSlider.create(rangeSlider, {
          start: 0,
          connect: "lower",
          range: {
            min: 0,
            max: 100
          }
        });

        rangeSlider.noUiSlider.on("update", function(values, handle) {
          $(valueShow).text(parseInt(values[handle]));
          $("#publish-button").data("value", parseInt(values[handle]));
        });

        $("button").click(function(e) {
          $.snackbar({ content: snackbarMessage });
          var value = $(this).data("value") + "";
          message = new Paho.MQTT.Message(value);

          message.destinationName = MQTTpublishTopic;
          client.send(message);
        });
      });

      function onMessageArrived(message) {
        let value = message.payloadString.split(":");
        console.log(value);
        if (value[0] === "D") {
          document.getElementById("d").innerHTML = value[1];
          value = [];
        } else if (value[0] === "T3") {
          document.getElementById("t3").innerHTML = value[1];
          value = [];
        } else if (value[0] === "T8") {
          document.getElementById("t8").innerHTML = value[1];
          value = [];
        } else if (value[0] === "PIR") {
          document.getElementById("pir").innerHTML = value[1];
          value = [];
        }
        console.log("onMessageArrived:" + message.payloadString);
      }
    </script>
  </body>
</html>